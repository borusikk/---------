{% extends 'base.html' %} {% block title %}üìä –†–µ–π—Ç–∏–Ω–≥ –∫–∞—Ñ–µ–¥—Ä{% endblock title %}
{% block content %}
<main class="container py-4">
  <header class="text-center mb-4">
    <h1 class="h2">üìä –†–µ–π—Ç–∏–Ω–≥ –∫–∞—Ñ–µ–¥—Ä –•–ù–£–†–ï</h1>
    <p class="text-muted">–ü–æ—Ä—ñ–≤–Ω—è–ª—å–Ω–∞ –æ—Ü—ñ–Ω–∫–∞ –∫–∞—Ñ–µ–¥—Ä —É–Ω—ñ–≤–µ—Ä—Å–∏—Ç–µ—Ç—É</p>
  </header>

  <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
  <div class="row g-3 mb-4">
    <div class="col-md-4">
      <div class="p-3 bg-light rounded text-center">
        <i class="fas fa-graduation-cap mb-2"></i>
        <div class="h4">{{ departments|length }}</div>
        <small class="text-muted">–ö–∞—Ñ–µ–¥—Ä</small>
      </div>
    </div>
    <div class="col-md-4">
      <div class="p-3 bg-light rounded text-center">
        <i class="fas fa-star mb-2"></i>
        <div class="h4">{{ departments.0.name }}</div>
        <small class="text-muted">–õ—ñ–¥–µ—Ä</small>
      </div>
    </div>
    <div class="col-md-4">
      <div class="p-3 bg-light rounded text-center">
        <i class="fas fa-user-tie mb-2"></i>
        <div class="h4">{{ total_professors|default:"500+" }}</div>
        <small class="text-muted">–í–∏–∫–ª–∞–¥–∞—á—ñ–≤</small>
      </div>
    </div>
  </div>

  <!-- –§–∏–ª—å—Ç—Ä—ã -->
  <div class="row g-2 mb-4">
    <div class="col-md-6">
      <input
        type="text"
        id="department-search"
        class="form-control"
        placeholder="üîç –ü–æ—à—É–∫ –∫–∞—Ñ–µ–¥—Ä–∏"
      />
    </div>
    <div class="col-md-6">
      <select id="faculty-filter" class="form-select">
        <option value="">üìö –í—Å—ñ —Ñ–∞–∫—É–ª—å—Ç–µ—Ç–∏</option>
        {% for faculty in faculties %}
        <option value="{{ faculty.id }}">{{ faculty.name }}</option>
        {% endfor %}
      </select>
    </div>
  </div>

  <!-- –¢–∞–±–ª–∏—Ü–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞ -->
  <div class="table-responsive d-none d-lg-block">
    <table class="table">
      <thead>
        <tr>
          <th>#</th>
          <th>–ö–∞—Ñ–µ–¥—Ä–∞</th>
          <th>–§–∞–∫—É–ª—å—Ç–µ—Ç</th>
          <th class="text-center">–ü—Ä–æ—Ñ–µ—Å—ñ–æ–Ω–∞–ª—ñ–∑–º</th>
          <th class="text-center">–ü–æ—è—Å–Ω–µ–Ω–Ω—è</th>
          <th class="text-center">–°—Ç–∞–≤–ª–µ–Ω–Ω—è</th>
          <th class="text-center">–†–µ–π—Ç–∏–Ω–≥</th>
          <th class="text-center">–í–∏–∫–ª–∞–¥–∞—á—ñ</th>
        </tr>
      </thead>
      <tbody>
        {% for department in departments %}
        <tr
          class="{% if forloop.first %}table-warning{% endif %}"
          data-faculty-id="{{ department.faculty.id }}"
        >
          <td class="text-center">{{ forloop.counter }}</td>
          <td>
            <a href="{% url 'department_detail' department.id %}"
              >{{ department.name }}</a
            >
          </td>
          <td>
            <span class="badge bg-light text-dark"
              >{{ department.faculty.name }}</span
            >
          </td>
          <td class="text-center">
            {{ department.avg_professionalism|default:"‚Äî"|floatformat:1 }} ‚≠ê
          </td>
          <td class="text-center">
            {{ department.avg_clarity|default:"‚Äî"|floatformat:1 }} ‚≠ê
          </td>
          <td class="text-center">
            {{ department.avg_attitude|default:"‚Äî"|floatformat:1 }} ‚≠ê
          </td>
          <td class="text-center fw-bold">
            {{ department.avg_rating|default:"‚Äî"|floatformat:1 }} ‚≠ê
          </td>
          <td class="text-center">{{ department.professor_count }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- –ú–æ–±–∏–ª—å–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ -->
  <div class="d-lg-none">
    {% for department in departments %}
    <div
      class="card mb-3 department-card"
      data-faculty-id="{{ department.faculty.id }}"
    >
      <div class="card-body">
        <div class="d-flex justify-content-between mb-2">
          <h5 class="card-title">
            <span class="badge bg-secondary me-1">{{ forloop.counter }}</span>
            <a href="{% url 'department_detail' department.id %}"
              >{{ department.name }}</a
            >
          </h5>
          <span class="badge bg-light text-dark"
            >{{ department.faculty.name }}</span
          >
        </div>
        <div class="row g-2 text-center mb-2">
          <div class="col-4">
            <small class="d-block text-muted">–ü—Ä–æ—Ñ–µ—Å—ñ–æ–Ω–∞–ª—ñ–∑–º</small>
            <div>
              {{ department.avg_professionalism|default:"‚Äî"|floatformat:1 }} ‚≠ê
            </div>
          </div>
          <div class="col-4">
            <small class="d-block text-muted">–ü–æ—è—Å–Ω–µ–Ω–Ω—è</small>
            <div>{{ department.avg_clarity|default:"‚Äî"|floatformat:1 }} ‚≠ê</div>
          </div>
          <div class="col-4">
            <small class="d-block text-muted">–°—Ç–∞–≤–ª–µ–Ω–Ω—è</small>
            <div>
              {{ department.avg_attitude|default:"‚Äî"|floatformat:1 }} ‚≠ê
            </div>
          </div>
        </div>
        <div class="d-flex justify-content-between align-items-center">
          <small class="text-muted"
            >{{ department.professor_count }} –≤–∏–∫–ª–∞–¥–∞—á—ñ–≤</small
          >
          <div class="fw-bold">
            {{ department.avg_rating|default:"‚Äî"|floatformat:1 }} ‚≠ê
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
</main>

<style>
  .department-card {
    transition: transform 0.2s;
  }
  .department-card:hover {
    transform: translateY(-2px);
  }
  @media (max-width: 768px) {
    .container {
      padding-left: 10px;
      padding-right: 10px;
    }
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const searchInput = document.getElementById("department-search");
    const facultyFilter = document.getElementById("faculty-filter");
    const tableRows = document.querySelectorAll("tbody tr");
    const cards = document.querySelectorAll(".department-card");

    function filterItems() {
      const searchTerm = searchInput.value.toLowerCase();
      const selectedFaculty = facultyFilter.value; // –£–±–∏—Ä–∞–µ–º toLowerCase()

      // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã
      tableRows.forEach((row) => {
        const departmentName = row
          .querySelector("td:nth-child(2)")
          .textContent.toLowerCase();
        const facultyId = row.getAttribute("data-faculty-id");

        const matchesSearch = departmentName.includes(searchTerm);
        const matchesFaculty =
          !selectedFaculty || facultyId === selectedFaculty;

        row.style.display = matchesSearch && matchesFaculty ? "" : "none";
      });

      // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö –∫–∞—Ä—Ç–æ—á–µ–∫
      cards.forEach((card) => {
        const departmentName = card
          .querySelector(".card-title a")
          .textContent.toLowerCase();
        const facultyId = card.getAttribute("data-faculty-id");

        const matchesSearch = departmentName.includes(searchTerm);
        const matchesFaculty =
          !selectedFaculty || facultyId === selectedFaculty;

        card.style.display = matchesSearch && matchesFaculty ? "" : "none";
      });
    }

    searchInput.addEventListener("input", filterItems);
    facultyFilter.addEventListener("change", filterItems);

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    filterItems();
  });
</script>
{% endblock content %}
